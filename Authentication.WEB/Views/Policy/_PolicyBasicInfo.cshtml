@model InsuredTraveling.Models.Policy
@using InsuredTraveling.Filters;
@using System.Web.Optimization;
@using System.Configuration;

@{
    var dateFormat = ConfigurationManager.AppSettings["DateFormat"].ToUpper();
    if (dateFormat.Count(x => x == 'Y') == 2)
    {
        dateFormat = dateFormat.Replace("YY", "YYYY");
    }
    var policyTypeSava = ViewBag.Category ?? 1;
    var insuredNumber = ViewBag.PersonsNum ?? 1;
    var validDays = ViewBag.Days ?? 1;
}

<div class="form-group text-left">
    <h4>Вид</h4>
</div>
<div class="panel">
    <div class="panel-body">
        <div class="form-group">
            <label class="control-label pull-left">Пакет</label>
            <div class="selectContainer">
                <select id="policyPackageType" name="policyPackageType" class="form-control" title="Одбери">
                    <option value="1">Gold</option>
                    <option value="2">Platinum</option>
                    <option value="3">VIP</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label pull-left">Вид</label>
            <div class="selectContainer">
                <select id="policyTypeSava" name="policyTypeSava" class="form-control" title="Одбери">
                    <option value="1">Индивидуално</option>
                    <option value="2">Фамилијарно</option>
                    <option value="3">Студент</option>
                    <option value="4">Business</option>
                    <option value="5">Групно</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label pull-left">Број на лица</label>
            <div class="selectContainer">
                <select id="insuredNumber" name="insuredNumber" class="form-control" title="Одбери">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
        </div>
        <div>
            <label class="control-label pull-left">Период на престој во странство</label><br><br>
            <div class="form-group">
                <div class="input-group">
                    @*@Html.EditorFor(model => model.Start_Date, "{0:" + @ConfigurationManager.AppSettings["DateFormat"].ToString() + "}", new { htmlAttributes = new { @class = "form-control input-sm placeholder mandatoryField policyInfo" } })*@
                    <input type="hidden" id="start-date" name="Start_Date" />
                    <input type="hidden" id="end-date" name="End_Date" />
                    <input type="text" class="form-control" id="policy-daterange" />
                    @Html.ValidationMessageFor(model => model.Start_Date, "", new { @class = "text-danger" })
                    <span class="input-group-addon">
                        <i class="fa fa-calendar"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.Valid_Days, htmlAttributes: new { @class = "control-label" })
                <div class="input-group">
                    <input type="text" name="Valid_Days" id="Valid_Days" class="form-control input-sm mandatoryField policyInfo" style="position:static;" disabled />
                    <span class="input-group-addon">@InsuredTraveling.Resource.Policy_Days</span>
                </div>
                @Html.ValidationMessageFor(model => model.Valid_Days, "", new { @class = "text-danger" })
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {

        $("#policyTypeSava").val('@policyTypeSava');
        $("#insuredNumber").val('@insuredNumber');
        $("#Valid_Days").val(@validDays);

        $("#policy-daterange").daterangepicker({
            minDate: moment(),
            locale: {
                format: '@dateFormat'
            },
            startDate: moment(),
            endDate: moment().add(@validDays, 'days')
        });

        $('#policy-daterange').on('apply.daterangepicker', function (ev, picker) {
            var startDate = picker.startDate;
            $("#start-date").val(startDate.format('@dateFormat'));
            var endDate = picker.endDate;
            $("#end-date").val(endDate.format('@dateFormat'));
            var dateDiff = endDate.diff(startDate, 'days');
            $("#Valid_Days").val(dateDiff);
        });



    })
</script>
